<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#3b8526">
    <meta name="description" content="Juego Impostor estilo Spyfall con tem√°tica Minecraft">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Impostor Minecraft">

    <!-- Manifest para PWA -->
    <link rel="manifest" href="/manifest.json">

    <!-- Iconos para PWA -->
    <link rel="icon" href="./imgs/logo.png">
    <link rel="apple-touch-icon" href="./imgs/logo.png">

    <title>IMPOSTOR - Minecraft Edition</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --mc-green: #3b8526;
            --mc-dark-green: #2a631c;
            --mc-brown: #8b4513;
            --mc-gray: #7a7a7a;
            --mc-light-gray: #c6c6c6;
            --mc-black: #1e1e1e;
            --mc-yellow: #ffd700;
            --mc-red: #c72a2a;
            --mc-blue: #3a6ea5;
            --mc-purple: #9b30ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--mc-black);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Notificaciones en lugar de alerts */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(30, 30, 30, 0.95);
            border: 3px solid var(--mc-green);
            border-radius: 10px;
            padding: 15px 25px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            color: var(--mc-yellow);
            text-align: center;
            z-index: 2000;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            display: none;
            animation: slideDownNotification 0.3s ease-out;
        }

        @keyframes slideDownNotification {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .notification.error {
            border-color: var(--mc-red);
            color: var(--mc-red);
        }

        .notification.success {
            border-color: var(--mc-green);
            color: var(--mc-yellow);
        }

        .notification.info {
            border-color: var(--mc-blue);
            color: var(--mc-yellow);
        }

        /* Bot√≥n de configuraci√≥n */
        .config-btn {
            position: fixed;
            top: max(20px, env(safe-area-inset-top));
            right: max(20px, env(safe-area-inset-right));
            width: 3.5rem;
            height: 3.5rem;
            background-color: var(--mc-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            border: 0.2rem solid var(--mc-dark-green);
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .config-btn:hover,
        .config-btn:active {
            transform: rotate(30deg);
        }

        .config-btn i {
            font-size: 1.5rem;
            color: white;
        }

        /* Men√∫ de configuraci√≥n */
        .config-menu {
            position: fixed;
            top: calc(3.5rem + max(20px, env(safe-area-inset-top)));
            right: max(20px, env(safe-area-inset-right));
            background-color: rgba(30, 30, 30, 0.98);
            border: 0.25rem solid var(--mc-brown);
            border-radius: 1rem;
            padding: 1.5rem;
            width: min(22rem, 90vw);
            z-index: 999;
            display: none;
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.5);
        }

        .config-menu.active {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-1rem);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-title {
            font-family: 'Press Start 2P', cursive;
            color: var(--mc-yellow);
            font-size: 1rem;
            margin-bottom: 1.2rem;
            text-align: center;
        }

        .config-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 0.125rem solid var(--mc-gray);
        }

        .config-label {
            display: block;
            color: var(--mc-green);
            margin-bottom: 0.6rem;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .config-input {
            width: 100%;
            padding: 0.8rem;
            background-color: #111;
            border: 0.125rem solid var(--mc-gray);
            border-radius: 0.5rem;
            color: white;
            font-size: 1rem;
            font-family: 'Roboto', sans-serif;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--mc-green);
        }

        .time-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .time-option {
            padding: 0.7rem;
            text-align: center;
            background-color: #222;
            border: 0.125rem solid var(--mc-gray);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            touch-action: manipulation;
        }

        .time-option:active {
            transform: scale(0.95);
        }

        .time-option.selected {
            background-color: var(--mc-green);
            border-color: var(--mc-yellow);
            color: white;
        }

        /* Pantallas principales */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.4s ease, transform 0.4s ease;
            background-color: var(--mc-black);
            z-index: 10;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .screen.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(-2rem);
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
            transform: translateX(0);
        }

        .container {
            max-width: 100%;
            width: 100%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Pantalla 1: Categor√≠as */
        #screen1 {
            background: linear-gradient(135deg, rgba(30, 30, 30, 1) 0%, rgba(139, 69, 19, 0.8) 100%);
        }

        .title {
            font-family: 'Press Start 2P', cursive;
            color: var(--mc-yellow);
            text-align: center;
            font-size: clamp(1.8rem, 7vw, 3.5rem);
            margin-bottom: 0.5rem;
            text-shadow: 0.25rem 0.25rem 0 var(--mc-dark-green);
            line-height: 1.2;
            padding: 0 0.5rem;
        }

        .subtitle {
            font-family: 'Press Start 2P', cursive;
            color: var(--mc-green);
            text-align: center;
            font-size: clamp(0.8rem, 3.5vw, 1.5rem);
            margin-bottom: 1.5rem;
            text-shadow: 0.125rem 0.125rem 0 #000;
            padding: 0 0.5rem;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(9rem, 45vw), 1fr));
            gap: 0.8rem;
            margin-bottom: 2rem;
            width: 100%;
            max-width: 50rem;
            padding: 0 0.5rem;
        }

        /* Mejoras para m√≥vil: categor√≠as m√°s compactas */
        @media (max-width: 480px) {
            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.7rem;
            }
        }

        .category-card {
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 0.8rem;
            padding: 1rem;
            border: 0.2rem solid var(--mc-gray);
            position: relative;
            overflow: hidden;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            min-height: 9rem;
        }

        .category-card.selected {
            border-color: var(--mc-green);
            box-shadow: 0 0 1rem rgba(59, 133, 38, 0.5);
        }

        .category-icon {
            font-size: clamp(2rem, 8vw, 3.5rem);
            margin-bottom: 0.5rem;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-name {
            font-family: 'Press Start 2P', cursive;
            color: white;
            margin-bottom: 0.5rem;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            line-height: 1.3;
            padding: 0 0.3rem;
        }

        /* Checkbox redise√±ado - SOLO aqu√≠ se selecciona/deselecciona */
        .category-check {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 1.8rem;
            height: 1.8rem;
            border-radius: 50%;
            background-color: var(--mc-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .category-check:active {
            transform: scale(0.9);
        }

        .category-card.selected .category-check {
            background-color: var(--mc-green);
        }

        .category-check i {
            font-size: 0.9rem;
        }

        /* Bot√≥n principal */
        .main-btn {
            display: block;
            width: 100%;
            max-width: 25rem;
            padding: 1.2rem;
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1rem, 4vw, 1.5rem);
            background-color: var(--mc-green);
            color: white;
            border: none;
            border-radius: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            border-bottom: 0.4rem solid var(--mc-dark-green);
            margin: 0 auto;
            touch-action: manipulation;
            min-height: 3.5rem;
        }

        .main-btn:active {
            transform: translateY(0.1rem);
            border-bottom-width: 0.2rem;
        }

        .main-btn:disabled {
            background-color: var(--mc-gray);
            border-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        /* Timer flotante */
        .floating-timer {
            position: fixed;
            top: max(1rem, env(safe-area-inset-top));
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1rem, 4.5vw, 1.8rem);
            color: var(--mc-yellow);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 0.6rem 1.2rem;
            border-radius: 0.8rem;
            border: 0.2rem solid var(--mc-green);
            z-index: 100;
            text-shadow: 0.125rem 0.125rem 0 #000;
            display: none;
            box-shadow: 0 0.3rem 1rem rgba(0, 0, 0, 0.5);
            white-space: nowrap;
        }

        .floating-timer.warning {
            color: var(--mc-red);
            border-color: var(--mc-red);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        /* Estado del juego */
        .game-status {
            position: fixed;
            top: calc(max(1rem, env(safe-area-inset-top)) + 3.5rem);
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 0.6rem 1rem;
            border-radius: 0.8rem;
            border: 0.2rem solid var(--mc-green);
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.65rem, 2.8vw, 0.9rem);
            text-align: center;
            z-index: 99;
            display: none;
            max-width: 90%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .game-status.active {
            display: block;
            animation: slideDown 0.5s;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-1rem);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Bot√≥n de votaci√≥n flotante */
        .floating-vote-btn {
            position: fixed;
            bottom: max(1.5rem, env(safe-area-inset-bottom));
            right: max(1.5rem, env(safe-area-inset-right));
            background-color: var(--mc-red);
            color: white;
            border: none;
            border-radius: 2.5rem;
            padding: clamp(0.8rem, 3vw, 1rem) clamp(1.2rem, 3.5vw, 1.8rem);
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.85rem, 2.8vw, 1.1rem);
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0.3rem 0.8rem rgba(0, 0, 0, 0.4);
            display: none;
            transition: all 0.3s;
            touch-action: manipulation;
            min-height: 3rem;
        }

        .floating-vote-btn:active {
            transform: scale(0.95);
        }

        /* Pantalla 2: Asignaci√≥n de jugadores */
        #screen2 {
            background: linear-gradient(135deg, rgba(30, 30, 30, 1) 0%, rgba(58, 110, 165, 0.8) 100%);
        }

        .player-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            max-width: 40rem;
            margin: 0 auto;
            padding: 1rem;
        }

        .player-name-display {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.3rem, 6vw, 2.2rem);
            color: var(--mc-yellow);
            margin-bottom: 1.5rem;
            text-shadow: 0.2rem 0.2rem 0 #000;
            line-height: 1.2;
            padding: 0 1rem;
            word-break: break-word;
        }

        .tap-instruction {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.9rem, 3.5vw, 1.3rem);
            color: var(--mc-light-gray);
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
            text-align: center;
            padding: 0 1rem;
        }

        .tap-area {
            width: min(10rem, 55vw);
            height: min(10rem, 55vw);
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 0.3rem dashed var(--mc-gray);
            margin-bottom: 1.5rem;
            cursor: pointer;
            touch-action: manipulation;
            transition: transform 0.2s;
        }

        .tap-area:active {
            transform: scale(0.95);
        }

        .tap-area i {
            font-size: clamp(2rem, 9vw, 3.5rem);
            color: var(--mc-gray);
        }

        /* Estado revelado */
        .revealed-content {
            display: none;
            width: 100%;
        }

        .revealed-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .word-display {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.3rem, 7vw, 3rem);
            color: var(--mc-yellow);
            margin-bottom: 1.2rem;
            text-shadow: 0.25rem 0.25rem 0 #000;
            min-height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 1rem;
            word-break: break-word;
            text-align: center;
            line-height: 1.3;
        }

        .spy-display {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(1.3rem, 6vw, 2.5rem);
            color: var(--mc-red);
            margin-bottom: 1.2rem;
            text-shadow: 0.25rem 0.25rem 0 #000;
            padding: 0 1rem;
            line-height: 1.3;
        }

        .category-indicator {
            display: inline-block;
            background-color: var(--mc-purple);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            margin-bottom: 1.2rem;
        }

        /* Pantalla 3: Votaci√≥n individual */
        #screen3 {
            background: linear-gradient(135deg, rgba(30, 30, 30, 1) 0%, rgba(199, 42, 42, 0.8) 100%);
        }

        .voting-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            width: 100%;
            max-width: 40rem;
            margin: 0 auto;
            padding: 1rem;
            overflow-y: auto;
        }

        .vote-instruction {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.9rem, 3.5vw, 1.3rem);
            color: var(--mc-yellow);
            margin-bottom: 1rem;
            text-align: center;
            padding: 0 1rem;
            line-height: 1.3;
        }

        .vote-subtitle {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.65rem, 2.8vw, 0.9rem);
            color: var(--mc-light-gray);
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0 1rem;
            line-height: 1.4;
        }

        .vote-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(7rem, 40vw), 1fr));
            gap: 0.8rem;
            margin: 1.2rem 0;
            width: 100%;
            max-width: 40rem;
        }

        /* Mejoras para m√≥vil: opciones de votaci√≥n */
        @media (max-width: 480px) {
            .vote-options-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.7rem;
            }
        }

        .vote-option {
            background-color: rgba(0, 0, 0, 0.7);
            border: 0.2rem solid var(--mc-gray);
            border-radius: 0.8rem;
            padding: 1rem 0.6rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            touch-action: manipulation;
            min-height: 5rem;
        }

        .vote-option:active {
            transform: scale(0.95);
        }

        .vote-option.selected {
            background-color: var(--mc-yellow);
            border-color: var(--mc-yellow);
            color: var(--mc-black);
            transform: translateY(-0.2rem);
            box-shadow: 0 0.3rem 0.8rem rgba(255, 215, 0, 0.3);
        }

        .vote-player-name {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.65rem, 2.8vw, 1rem);
            margin-bottom: 0.3rem;
            line-height: 1.3;
            word-break: break-word;
        }

        /* Barras de progreso */
        .progress-bar,
        .voting-progress-bar {
            width: 100%;
            height: 0.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.3rem;
            margin-bottom: 1rem;
            overflow: hidden;
            max-width: 25rem;
        }

        .progress,
        .voting-progress {
            height: 100%;
            background-color: var(--mc-green);
            width: 0%;
            transition: width 0.5s;
        }

        .voting-progress {
            background-color: var(--mc-red);
        }

        .progress-text,
        .voting-progress-text {
            text-align: center;
            font-family: 'Press Start 2P', cursive;
            color: var(--mc-light-gray);
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            margin-bottom: 1.2rem;
        }

        /* Resultados */
        .results {
            margin-top: 1.2rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 0.8rem;
            border: 0.2rem solid var(--mc-purple);
            display: none;
            width: 100%;
            max-width: 40rem;
            overflow-y: auto;
            max-height: 40vh;
            font-size: 0.85rem;
        }

        .results.active {
            display: block;
        }

        .winner {
            font-family: 'Press Start 2P', cursive;
            font-size: clamp(0.9rem, 3.5vw, 1.5rem);
            color: var(--mc-yellow);
            margin-bottom: 0.8rem;
            text-align: center;
            line-height: 1.3;
        }

        /* Texto informativo */
        .info-text {
            text-align: center;
            color: var(--mc-light-gray);
            font-size: clamp(0.65rem, 2.8vw, 0.85rem);
            margin-top: 1.2rem;
            padding: 0 1rem;
            line-height: 1.4;
        }

        /* Mejoras para pantallas muy peque√±as */
        @media (max-width: 360px) {
            .title {
                font-size: clamp(1.5rem, 6vw, 2rem);
            }

            .subtitle {
                font-size: clamp(0.7rem, 3vw, 1rem);
                margin-bottom: 1rem;
            }

            .categories-grid {
                gap: 0.6rem;
            }

            .category-card {
                padding: 0.8rem;
                min-height: 8rem;
            }

            .main-btn {
                padding: 1rem;
                font-size: 0.9rem;
            }

            .player-name-display {
                font-size: clamp(1.1rem, 5vw, 1.8rem);
            }

            .tap-area {
                width: min(9rem, 50vw);
                height: min(9rem, 50vw);
            }
        }

        /* Orientaci√≥n horizontal en m√≥viles */
        @media (orientation: landscape) and (max-height: 500px) {
            .title {
                font-size: clamp(1.3rem, 3.5vw, 1.8rem);
                margin-bottom: 0.3rem;
            }

            .subtitle {
                font-size: clamp(0.7rem, 2vw, 1rem);
                margin-bottom: 0.8rem;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(min(6rem, 18vw), 1fr));
                gap: 0.5rem;
                margin-bottom: 0.8rem;
            }

            .category-card {
                padding: 0.5rem;
                min-height: 6rem;
            }

            .category-icon {
                font-size: clamp(1.3rem, 4vw, 1.8rem);
                margin-bottom: 0.2rem;
            }

            .category-name {
                font-size: clamp(0.6rem, 1.8vw, 0.75rem);
            }

            .main-btn {
                padding: 0.7rem;
                font-size: clamp(0.8rem, 2.2vw, 1rem);
                min-height: 3rem;
            }

            .player-name-display {
                font-size: clamp(1rem, 3.5vw, 1.3rem);
                margin-bottom: 0.8rem;
            }

            .tap-area {
                width: min(6rem, 25vh);
                height: min(6rem, 25vh);
                margin-bottom: 0.8rem;
            }

            .word-display,
            .spy-display {
                font-size: clamp(1rem, 3.5vw, 1.5rem);
                margin-bottom: 0.8rem;
            }

            .vote-options-grid {
                grid-template-columns: repeat(auto-fill, minmax(min(5rem, 15vw), 1fr));
                gap: 0.5rem;
                margin: 0.8rem 0;
            }
        }

        /* Prevenir zoom en inputs en iOS */
        @media screen and (max-width: 768px) {

            input,
            select,
            textarea {
                font-size: 16px !important;
            }
        }

        /* Mejorar visualizaci√≥n en Safari iOS */
        @supports (-webkit-touch-callout: none) {
            .screen {
                height: -webkit-fill-available;
            }

            body {
                min-height: -webkit-fill-available;
            }

            .main-btn,
            .floating-vote-btn,
            .category-check,
            .time-option {
                cursor: pointer;
            }
        }
    </style>
</head>

<body>
    <!-- Notificaci√≥n en lugar de alert -->
    <div class="notification" id="notification"></div>

    <!-- Bot√≥n de configuraci√≥n -->
    <div class="config-btn" id="config-btn">
        <i class="fas fa-cog"></i>
    </div>

    <!-- Men√∫ de configuraci√≥n -->
    <div class="config-menu" id="config-menu">
        <h3 class="config-title">‚öôÔ∏è CONFIGURACI√ìN</h3>

        <div class="config-section">
            <label class="config-label">JUGADORES (Separados por comas)</label>
            <input type="text" id="players-input" class="config-input" placeholder="Ej: Juan, Ana, Pedro">
            <div style="color: #888; font-size: 0.7rem; margin-top: 0.3rem;">M√≠nimo: 3 jugadores</div>
        </div>

        <div class="config-section">
            <label class="config-label">TIEMPO DE JUEGO</label>
            <div class="time-options">
                <div class="time-option" data-time="60">1 min</div>
                <div class="time-option selected" data-time="180">3 min</div>
                <div class="time-option" data-time="300">5 min</div>
            </div>
        </div>

        <div class="config-section">
            <label class="config-label">CATEGOR√çAS ACTIVAS</label>
            <div style="color: #888; font-size: 0.8rem;">Se configuran en pantalla principal</div>
        </div>

        <button id="save-config" class="main-btn" style="margin-top: 1rem; padding: 0.8rem; font-size: 0.9rem;">
            GUARDAR CONFIGURACI√ìN
        </button>
    </div>

    <!-- Timer flotante -->
    <div class="floating-timer" id="floating-timer">
        05:00
    </div>

    <!-- Estado del juego -->
    <div class="game-status" id="game-status">
        üéÆ JUEGO EN CURSO - Discute con los dem√°s jugadores
    </div>

    <!-- Bot√≥n de votaci√≥n flotante -->
    <button class="floating-vote-btn" id="floating-vote-btn">
        üó≥Ô∏è ¬°HORA DE VOTAR!
    </button>

    <!-- Pantalla 1: Categor√≠as -->
    <div id="screen1" class="screen active">
        <div class="container">
            <h1 class="title">IMPOSTOR</h1>
            <h2 class="subtitle">Minecraft Edition</h2>

            <p class="info-text" style="margin-bottom: 1.2rem;">
                Selecciona las categor√≠as para esta partida
            </p>

            <div class="categories-grid" id="categories-container">
                <!-- Las categor√≠as se generar√°n aqu√≠ con JavaScript -->
            </div>

            <button id="start-round-btn" class="main-btn">SIGUIENTE RONDA</button>

            <p class="info-text" style="margin-top: 1.2rem;">
                üëÜ Usa el engranaje arriba a la derecha para configurar jugadores y tiempo
            </p>
            <p class="info-text">
                üéÆ Selecciona al menos una categor√≠a para jugar
            </p>
        </div>
    </div>

    <!-- Pantalla 2: Asignaci√≥n de jugadores -->
    <div id="screen2" class="screen hidden">
        <div class="container">
            <div class="progress-bar">
                <div class="progress" id="player-progress"></div>
            </div>
            <div class="progress-text" id="progress-text">Jugador 1 de 5</div>

            <div class="player-screen">
                <div class="player-name-display" id="current-player-name">JUAN</div>

                <!-- Estado 1: Antes de revelar -->
                <div id="state1">
                    <div class="tap-instruction">TOCA LA PANTALLA</div>
                    <div class="tap-area" id="tap-area">
                        <i class="fas fa-hand-pointer"></i>
                    </div>
                    <div class="info-text">
                        Toca para revelar tu informaci√≥n
                    </div>
                </div>

                <!-- Estado 2: Revelado -->
                <div class="revealed-content" id="state2">
                    <div class="category-indicator" id="category-indicator">BIOMAS</div>

                    <div id="normal-player-content">
                        <div class="word-display" id="secret-word">PLAYA</div>
                        <div class="info-text" style="margin-bottom: 1.2rem;">
                            Esta es tu palabra secreta
                        </div>
                    </div>

                    <div id="spy-player-content" style="display: none;">
                        <div class="spy-display">üïµÔ∏è ERES EL ESP√çA</div>
                        <div class="info-text" style="margin-bottom: 1.2rem; max-width: 30rem;">
                            No conoces la palabra secreta. Intenta adivinarla o pasar desapercibido.
                        </div>
                    </div>

                    <button id="next-player-btn" class="main-btn">SIGUIENTE JUGADOR</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla 3: Votaci√≥n individual -->
    <div id="screen3" class="screen hidden">
        <div class="container">
            <div class="voting-progress-bar">
                <div class="voting-progress" id="voting-progress"></div>
            </div>
            <div class="voting-progress-text" id="voting-progress-text">Votante 1 de 5</div>

            <div class="voting-screen">
                <div class="player-name-display" id="voting-player-name">JUAN</div>

                <div class="vote-instruction">¬øQUI√âN CREES QUE ES EL ESP√çA?</div>
                <div class="vote-subtitle">Selecciona al jugador que crees que es el impostor</div>

                <div class="vote-options-grid" id="vote-options-grid">
                    <!-- Las opciones de votaci√≥n se generar√°n aqu√≠ -->
                </div>

                <button id="submit-vote-btn" class="main-btn" style="display: none;">‚úÖ CONFIRMAR VOTO</button>
                <button id="next-voter-btn" class="main-btn">SIGUIENTE VOTANTE</button>

                <div class="results" id="results">
                    <!-- Los resultados se mostrar√°n aqu√≠ -->
                </div>

                <button id="new-game-btn" class="main-btn" style="margin-top: 1rem; display: none;">
                    üéÆ NUEVA PARTIDA
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== DATOS DEL JUEGO ==========
        const gameData = {
            players: ["Juan", "Ana", "Pedro", "Luis", "Mar√≠a"],
            categories: [
                {
                    id: 'biomes',
                    name: 'Biomas üå¥',
                    icon: 'üå¥',
                    selected: true,
                    words: [
                        'Bosque', 'Desierto', 'Llanura', 'Jungla', 'Taiga',
                        'Tundra', 'Pantano', 'Monta√±a', 'Oc√©ano', 'R√≠o',
                        'Playa', 'Isla de setas', 'Bosque oscuro', 'Sabana', 'Llanura de hielo'
                    ]
                },
                {
                    id: 'structures',
                    name: 'Estructuras üè∞',
                    icon: 'üè∞',
                    selected: true,
                    words: [
                        'Aldea', 'Templo del desierto', 'Templo de la jungla', 'Fortaleza del Nether',
                        'Mansi√≥n del bosque', 'Monumento oce√°nico', 'Ciudad del End', 'Mina abandonada',
                        'Pir√°mide', 'Ruinas oce√°nicas', 'Buque hundido', 'Puesto de pillos'
                    ]
                },
                {
                    id: 'items',
                    name: 'Items ‚öîÔ∏è',
                    icon: '‚öîÔ∏è',
                    selected: true,
                    words: [
                        'Pico de diamante', 'Espada de hierro', 'Manzana dorada', 'Br√∫jula', 'Mapa',
                        'Enderperla', 'Ojo de ender', 'Bloque de diamante', 'Mesa de crafteo', 'Horno'
                    ]
                },
                {
                    id: 'mobs',
                    name: 'Mobs üëæ',
                    icon: 'üëæ',
                    selected: true,
                    words: [
                        'Creeper', 'Zombie', 'Esqueleto', 'Ara√±a', 'Enderman',
                        'Slime', 'Ghast', 'Cerdito', 'Vaca', 'Oveja',
                        'Granjero', 'Bruja', 'Drag√≥n del End', 'Wither'
                    ]
                }
            ],
            spyIndex: -1,
            secretWord: '',
            currentPlayerIndex: 0,
            currentVoterIndex: 0,
            selectedCategory: null,
            gameTime: 180, // 3 minutos por defecto (en segundos)
            timerInterval: null,
            timeLeft: 0,
            votes: {},
            votingInProgress: false,
            gameState: 'setup' // setup, assigning, playing, voting, ended
        };

        // ========== VARIABLES DE ESTADO ==========
        let revealedThisPlayer = false;
        let currentVoteSelection = null;

        // ========== ELEMENTOS DOM ==========
        const configBtn = document.getElementById('config-btn');
        const configMenu = document.getElementById('config-menu');
        const playersInput = document.getElementById('players-input');
        const timeOptions = document.querySelectorAll('.time-option');
        const saveConfigBtn = document.getElementById('save-config');

        const screen1 = document.getElementById('screen1');
        const screen2 = document.getElementById('screen2');
        const screen3 = document.getElementById('screen3');

        const categoriesContainer = document.getElementById('categories-container');
        const startRoundBtn = document.getElementById('start-round-btn');
        const tapArea = document.getElementById('tap-area');
        const nextPlayerBtn = document.getElementById('next-player-btn');

        const floatingTimer = document.getElementById('floating-timer');
        const gameStatus = document.getElementById('game-status');
        const floatingVoteBtn = document.getElementById('floating-vote-btn');

        const voteOptionsGrid = document.getElementById('vote-options-grid');
        const submitVoteBtn = document.getElementById('submit-vote-btn');
        const nextVoterBtn = document.getElementById('next-voter-btn');
        const results = document.getElementById('results');
        const newGameBtn = document.getElementById('new-game-btn');
        const playerProgress = document.getElementById('player-progress');
        const progressText = document.getElementById('progress-text');
        const votingProgress = document.getElementById('voting-progress');
        const votingProgressText = document.getElementById('voting-progress-text');
        const notification = document.getElementById('notification');

        // ========== FUNCIONES DE NOTIFICACI√ìN (reemplazan alerts) ==========
        function showNotification(message, type = 'info', duration = 3000) {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';

            // Auto-ocultar despu√©s de la duraci√≥n
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        // ========== FUNCIONES AUXILIARES ==========
        function showScreen(screenId) {
            // Oculta todas las pantallas
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
                screen.classList.add('hidden');
            });

            // Muestra la pantalla solicitada
            const targetScreen = document.getElementById(screenId);
            targetScreen.classList.remove('hidden');
            setTimeout(() => {
                targetScreen.classList.add('active');
            }, 10);

            // Asegurar que el contenido est√© en la parte superior en m√≥viles
            if (targetScreen) {
                targetScreen.scrollTop = 0;
            }
        }

        function updateStartButtonState() {
            const hasSelected = gameData.categories.some(cat => cat.selected);
            startRoundBtn.disabled = !hasSelected;
        }

        // ========== CONFIGURACI√ìN ==========
        configBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            configMenu.classList.toggle('active');
        });

        // Cerrar men√∫ de configuraci√≥n al hacer clic fuera
        document.addEventListener('click', (e) => {
            if (!configMenu.contains(e.target) && !configBtn.contains(e.target)) {
                configMenu.classList.remove('active');
            }
        });

        // Cerrar men√∫ de configuraci√≥n al tocar fuera en m√≥vil
        document.addEventListener('touchstart', (e) => {
            if (!configMenu.contains(e.target) && !configBtn.contains(e.target)) {
                configMenu.classList.remove('active');
            }
        });

        // Seleccionar tiempo
        timeOptions.forEach(option => {
            option.addEventListener('click', () => {
                timeOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                gameData.gameTime = parseInt(option.dataset.time);
                showNotification(`Tiempo establecido a ${option.textContent}`, 'success', 1500);
            });

            // Soporte para toque en m√≥viles
            option.addEventListener('touchstart', (e) => {
                e.preventDefault();
                timeOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                gameData.gameTime = parseInt(option.dataset.time);
                showNotification(`Tiempo establecido a ${option.textContent}`, 'success', 1500);
            });
        });

        // Guardar configuraci√≥n
        saveConfigBtn.addEventListener('click', () => {
            const playersText = playersInput.value.trim();

            if (!playersText) {
                showNotification('Por favor, ingresa los nombres de los jugadores.', 'error', 3000);
                return;
            }

            // Parsear jugadores
            gameData.players = playersText.split(',')
                .map(name => name.trim())
                .filter(name => name.length > 0);

            if (gameData.players.length < 3) {
                showNotification('Se necesitan al menos 3 jugadores para jugar.', 'error', 3000);
                return;
            }

            if (gameData.players.length > 10) {
                showNotification('M√°ximo 10 jugadores permitidos.', 'error', 3000);
                return;
            }

            // Cerrar men√∫ de configuraci√≥n
            configMenu.classList.remove('active');

            // Actualizar informaci√≥n visual
            initCategories();
            updateStartButtonState();

            // Mostrar feedback t√°ctil en m√≥vil
            saveConfigBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                saveConfigBtn.style.transform = '';
            }, 150);

            showNotification('‚úÖ Configuraci√≥n guardada correctamente.', 'success', 2000);
        });

        // ========== CATEGOR√çAS ==========
        function initCategories() {
            categoriesContainer.innerHTML = '';

            gameData.categories.forEach(category => {
                const card = document.createElement('div');
                card.className = `category-card ${category.selected ? 'selected' : ''}`;
                card.dataset.id = category.id;

                card.innerHTML = `
                    <div class="category-check">${category.selected ? '<i class="fas fa-check"></i>' : ''}</div>
                    <div class="category-icon">${category.icon}</div>
                    <div class="category-name">${category.name}</div>
                `;

                // SOLO el checkbox puede seleccionar/deseleccionar
                const checkBox = card.querySelector('.category-check');

                // Evento click solo para el checkbox
                checkBox.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleCategory(category, card, checkBox);
                });

                // Evento touch solo para el checkbox
                checkBox.addEventListener('touchstart', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    toggleCategory(category, card, checkBox);
                });

                // El resto de la tarjeta NO hace nada (solo visual)
                card.addEventListener('click', (e) => {
                    if (e.target !== checkBox && !checkBox.contains(e.target)) {
                        // Solo da feedback visual pero no cambia selecci√≥n
                        card.style.transform = 'scale(0.98)';
                        setTimeout(() => {
                            card.style.transform = '';
                        }, 150);
                    }
                });

                card.addEventListener('touchstart', (e) => {
                    if (e.target !== checkBox && !checkBox.contains(e.target)) {
                        e.preventDefault();
                        // Solo da feedback visual pero no cambia selecci√≥n
                        card.style.transform = 'scale(0.98)';
                        setTimeout(() => {
                            card.style.transform = '';
                        }, 150);
                    }
                });

                categoriesContainer.appendChild(card);
            });
        }

        function toggleCategory(category, card, checkBox) {
            category.selected = !category.selected;
            card.classList.toggle('selected');
            checkBox.innerHTML = category.selected ? '<i class="fas fa-check"></i>' : '';
            updateStartButtonState();

            // Feedback t√°ctil en m√≥vil
            checkBox.style.transform = 'scale(0.9)';
            setTimeout(() => {
                checkBox.style.transform = '';
            }, 150);

            // Mostrar notificaci√≥n
            const status = category.selected ? 'activada' : 'desactivada';
            showNotification(`${category.name.split(' ')[0]} ${status}`, 'info', 1500);
        }

        // ========== INICIAR RONDA ==========
        startRoundBtn.addEventListener('click', () => {
            // Verificar que al menos una categor√≠a est√© seleccionada
            const selectedCategories = gameData.categories.filter(cat => cat.selected);

            if (selectedCategories.length === 0) {
                showNotification('Selecciona al menos una categor√≠a.', 'error', 3000);
                return;
            }

            // 3Ô∏è‚É£ SELECCI√ìN INTERNA (NO visible)
            // Elegir categor√≠a aleatoria de las seleccionadas
            const randomCatIndex = Math.floor(Math.random() * selectedCategories.length);
            gameData.selectedCategory = selectedCategories[randomCatIndex];

            // Elegir palabra secreta aleatoria de esa categor√≠a
            const wordIndex = Math.floor(Math.random() * gameData.selectedCategory.words.length);
            gameData.secretWord = gameData.selectedCategory.words[wordIndex];

            // Elegir esp√≠a aleatorio
            gameData.spyIndex = Math.floor(Math.random() * gameData.players.length);

            // Reiniciar √≠ndices
            gameData.currentPlayerIndex = 0;
            gameData.currentVoterIndex = 0;
            gameData.votes = {};
            gameData.votingInProgress = false;
            revealedThisPlayer = false;
            currentVoteSelection = null;

            // Ocultar bot√≥n de votaci√≥n (si est√° visible)
            floatingVoteBtn.style.display = 'none';

            // Ir a pantalla de asignaci√≥n de jugadores
            showScreen('screen2');
            showPlayer();

            showNotification('¬°Ronda iniciada! Pasa el dispositivo a cada jugador.', 'success', 2500);
        });

        // ========== ASIGNACI√ìN DE JUGADORES ==========
        function showPlayer() {
            const playerName = gameData.players[gameData.currentPlayerIndex];
            document.getElementById('current-player-name').textContent = playerName.toUpperCase();

            // Restablecer estado
            document.getElementById('state1').style.display = 'block';
            document.getElementById('state2').classList.remove('active');
            document.getElementById('state2').style.display = 'none';

            // Resetear variable de revelaci√≥n
            revealedThisPlayer = false;

            // Actualizar barra de progreso
            const progress = ((gameData.currentPlayerIndex) / gameData.players.length) * 100;
            playerProgress.style.width = `${progress}%`;
            progressText.textContent =
                `Jugador ${gameData.currentPlayerIndex + 1} de ${gameData.players.length}`;
        }

        // Tocar para revelar informaci√≥n
        tapArea.addEventListener('click', revealInfo);
        tapArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            revealInfo();
        });

        function revealInfo() {
            if (revealedThisPlayer) return;

            revealedThisPlayer = true;

            // Ocultar √°rea de toque
            document.getElementById('state1').style.display = 'none';

            // Mostrar contenido revelado
            const state2 = document.getElementById('state2');
            state2.style.display = 'block';
            setTimeout(() => {
                state2.classList.add('active');
            }, 10);

            // Mostrar categor√≠a
            document.getElementById('category-indicator').textContent =
                gameData.selectedCategory.name.split(' ')[0].toUpperCase();

            // Verificar si es el esp√≠a
            const isSpy = gameData.currentPlayerIndex === gameData.spyIndex;

            if (isSpy) {
                // Mostrar contenido de esp√≠a
                document.getElementById('normal-player-content').style.display = 'none';
                document.getElementById('spy-player-content').style.display = 'block';
                showNotification('¬°Eres el ESP√çA! No reveles tu identidad.', 'error', 4000);
            } else {
                // Mostrar contenido de jugador normal
                document.getElementById('normal-player-content').style.display = 'block';
                document.getElementById('spy-player-content').style.display = 'none';
                document.getElementById('secret-word').textContent = gameData.secretWord;
                showNotification(`Tu palabra es: ${gameData.secretWord}`, 'info', 4000);
            }

            // Feedback t√°ctil
            tapArea.style.transform = 'scale(0.9)';
            setTimeout(() => {
                tapArea.style.transform = '';
            }, 150);
        }

        // Siguiente jugador
        nextPlayerBtn.addEventListener('click', () => {
            gameData.currentPlayerIndex++;

            if (gameData.currentPlayerIndex < gameData.players.length) {
                showPlayer();
            } else {
                // Todos los jugadores han visto su informaci√≥n
                // Volver a pantalla de categor√≠as para empezar el juego
                showScreen('screen1');

                // Mostrar mensaje de juego en curso
                gameStatus.classList.add('active');
                gameStatus.innerHTML = 'üéÆ JUEGO EN CURSO - Discute con los dem√°s jugadores';

                // NO mostrar bot√≥n de votaci√≥n todav√≠a (solo cuando termine el tiempo)
                floatingVoteBtn.style.display = 'none';

                // Iniciar temporizador
                startGameTimer();

                // Mostrar timer flotante
                floatingTimer.style.display = 'block';

                // Cambiar texto del bot√≥n
                startRoundBtn.textContent = 'NUEVA RONDA';

                showNotification('¬°Todos listos! El juego comienza ahora. Discutan libremente. El temporizador ha comenzado.', 'success', 5000);
            }

            // Feedback t√°ctil
            nextPlayerBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                nextPlayerBtn.style.transform = '';
            }, 150);
        });

        // ========== TEMPORIZADOR ==========
        function startGameTimer() {
            // Limpiar intervalo anterior si existe
            if (gameData.timerInterval) {
                clearInterval(gameData.timerInterval);
            }

            gameData.timeLeft = gameData.gameTime;
            updateTimerDisplay();

            gameData.timerInterval = setInterval(() => {
                gameData.timeLeft--;
                updateTimerDisplay();

                if (gameData.timeLeft <= 30) {
                    floatingTimer.classList.add('warning');
                    gameStatus.innerHTML = '‚è∞ ¬°POCO TIEMPO! - Termina la discusi√≥n pronto';

                    if (gameData.timeLeft === 30) {
                        showNotification('¬°Quedan 30 segundos!', 'error', 2000);
                    }
                }

                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timerInterval);
                    endGameTime();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(gameData.timeLeft / 60);
            const seconds = gameData.timeLeft % 60;
            floatingTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function endGameTime() {
            floatingTimer.classList.add('warning');
            floatingTimer.textContent = '¬°TIEMPO!';
            gameStatus.innerHTML = '‚è∞ ¬°SE ACAB√ì EL TIEMPO! - Es hora de votar';

            // MOSTRAR BOT√ìN DE VOTACI√ìN (solo cuando termina el tiempo)
            floatingVoteBtn.style.display = 'block';

            // Hacer que el bot√≥n de votaci√≥n sea m√°s visible
            floatingVoteBtn.style.animation = 'pulse 1s infinite';

            showNotification('¬°Se acab√≥ el tiempo! Es hora de votar. Presiona el bot√≥n rojo para comenzar.', 'error', 4000);
        }

        // ========== VOTACI√ìN INDIVIDUAL ==========
        floatingVoteBtn.addEventListener('click', startVotingProcess);
        floatingVoteBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startVotingProcess();
        });

        function startVotingProcess() {
            // Ocultar bot√≥n de votaci√≥n
            floatingVoteBtn.style.display = 'none';
            floatingVoteBtn.style.animation = '';

            // Ocultar timer y estado
            floatingTimer.style.display = 'none';
            gameStatus.classList.remove('active');

            // Iniciar votaci√≥n
            gameData.currentVoterIndex = 0;
            gameData.votingInProgress = true;
            currentVoteSelection = null;

            // Ir a pantalla de votaci√≥n
            showScreen('screen3');
            showVoter();

            showNotification('Votaci√≥n iniciada. Pasa el dispositivo a cada votante.', 'info', 3000);
        }

        function showVoter() {
            const voterName = gameData.players[gameData.currentVoterIndex];
            document.getElementById('voting-player-name').textContent = voterName.toUpperCase();

            // Resetear selecci√≥n
            currentVoteSelection = null;
            submitVoteBtn.style.display = 'none';
            nextVoterBtn.style.display = 'block';

            // Actualizar barra de progreso de votaci√≥n
            const progress = ((gameData.currentVoterIndex) / gameData.players.length) * 100;
            votingProgress.style.width = `${progress}%`;
            votingProgressText.textContent =
                `Votante ${gameData.currentVoterIndex + 1} de ${gameData.players.length}`;

            // Generar opciones de votaci√≥n (todos menos el votante actual)
            generateVoteOptions();

            showNotification(`${voterName}, es tu turno de votar. Selecciona qui√©n crees que es el esp√≠a.`, 'info', 3000);
        }

        function generateVoteOptions() {
            voteOptionsGrid.innerHTML = '';

            gameData.players.forEach((player, index) => {
                // No permitir votarse a s√≠ mismo
                if (index === gameData.currentVoterIndex) return;

                const voteOption = document.createElement('div');
                voteOption.className = 'vote-option';
                voteOption.dataset.playerIndex = index;

                voteOption.innerHTML = `
                    <div class="vote-player-name">${player}</div>
                    <div style="font-size: 0.65rem; color: var(--mc-light-gray);">Toca para seleccionar</div>
                `;

                // Evento click para desktop
                voteOption.addEventListener('click', () => {
                    selectVoteOption(voteOption, index);
                });

                // Evento touch para m√≥viles
                voteOption.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    selectVoteOption(voteOption, index);
                });

                voteOptionsGrid.appendChild(voteOption);
            });
        }

        function selectVoteOption(voteOption, index) {
            // Deseleccionar todas las opciones
            document.querySelectorAll('.vote-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Seleccionar esta opci√≥n
            voteOption.classList.add('selected');
            currentVoteSelection = index;

            // Feedback t√°ctil
            voteOption.style.transform = 'scale(0.95)';
            setTimeout(() => {
                voteOption.style.transform = '';
            }, 150);

            // Mostrar bot√≥n para confirmar voto
            submitVoteBtn.style.display = 'block';
            nextVoterBtn.style.display = 'none';

            showNotification(`Seleccionaste: ${gameData.players[index]}`, 'info', 2000);
        }

        // Confirmar voto
        submitVoteBtn.addEventListener('click', confirmVote);
        submitVoteBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            confirmVote();
        });

        function confirmVote() {
            if (currentVoteSelection === null) {
                showNotification('Por favor, selecciona a un jugador antes de votar.', 'error', 3000);
                return;
            }

            // Feedback t√°ctil
            submitVoteBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                submitVoteBtn.style.transform = '';
            }, 150);

            // Registrar voto
            const voterName = gameData.players[gameData.currentVoterIndex];
            const votedPlayer = gameData.players[currentVoteSelection];
            gameData.votes[voterName] = votedPlayer;

            showNotification(`‚úÖ ${voterName} vot√≥ por ${votedPlayer}`, 'success', 2000);

            // Pausa antes de pasar al siguiente
            setTimeout(() => {
                gameData.currentVoterIndex++;

                if (gameData.currentVoterIndex < gameData.players.length) {
                    showVoter();
                } else {
                    // Todos han votado, mostrar resultados
                    showVotingResults();
                }
            }, 1500);
        }

        // Siguiente votante (sin votar)
        nextVoterBtn.addEventListener('click', nextVoter);
        nextVoterBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            nextVoter();
        });

        function nextVoter() {
            // Feedback t√°ctil
            nextVoterBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                nextVoterBtn.style.transform = '';
            }, 150);

            // Si no ha votado, registra un voto nulo
            const voterName = gameData.players[gameData.currentVoterIndex];
            gameData.votes[voterName] = null;

            showNotification(`‚è≠Ô∏è ${voterName} decidi√≥ no votar`, 'info', 2000);

            // Pausa antes de pasar al siguiente
            setTimeout(() => {
                gameData.currentVoterIndex++;

                if (gameData.currentVoterIndex < gameData.players.length) {
                    showVoter();
                } else {
                    // Todos han votado, mostrar resultados
                    showVotingResults();
                }
            }, 1500);
        }

        function showVotingResults() {
            // Calcular votos
            const voteCounts = {};
            gameData.players.forEach(player => {
                voteCounts[player] = 0;
            });

            // Contar votos v√°lidos
            Object.values(gameData.votes).forEach(votedPlayer => {
                if (votedPlayer !== null) {
                    voteCounts[votedPlayer]++;
                }
            });

            // Encontrar el m√°s votado
            let maxVotes = 0;
            let mostVotedPlayer = null;
            let tie = false;

            for (const [player, count] of Object.entries(voteCounts)) {
                if (count > maxVotes) {
                    maxVotes = count;
                    mostVotedPlayer = player;
                    tie = false;
                } else if (count === maxVotes && count > 0) {
                    tie = true;
                }
            }

            // Ocultar elementos de votaci√≥n
            voteOptionsGrid.style.display = 'none';
            submitVoteBtn.style.display = 'none';
            nextVoterBtn.style.display = 'none';

            // Mostrar resultados
            results.classList.add('active');

            let resultsHTML = `<div class="winner">¬°VOTACI√ìN TERMINADA!</div>`;

            resultsHTML += `<p style="margin-bottom: 0.6rem; font-size: 0.85rem;"><strong>Palabra secreta:</strong> ${gameData.secretWord}</p>`;
            resultsHTML += `<p style="margin-bottom: 0.6rem; font-size: 0.85rem;"><strong>Categor√≠a:</strong> ${gameData.selectedCategory.name}</p>`;
            resultsHTML += `<p style="margin-bottom: 0.6rem; font-size: 0.85rem;"><strong>El esp√≠a era:</strong> ${gameData.players[gameData.spyIndex]}</p>`;

            // Mostrar votos individuales
            resultsHTML += `<h4 style="color: var(--mc-yellow); margin: 0.8rem 0 0.4rem; font-size: 0.9rem;">VOTOS INDIVIDUALES:</h4>`;

            Object.entries(gameData.votes).forEach(([voter, voted]) => {
                if (voted === null) {
                    resultsHTML += `<p style="margin-bottom: 0.2rem; font-size: 0.75rem;">${voter}: No vot√≥</p>`;
                } else {
                    resultsHTML += `<p style="margin-bottom: 0.2rem; font-size: 0.75rem;">${voter} ‚Üí ${voted}</p>`;
                }
            });

            // Mostrar conteo final
            resultsHTML += `<h4 style="color: var(--mc-yellow); margin: 0.8rem 0 0.4rem; font-size: 0.9rem;">CONTEO FINAL:</h4>`;

            gameData.players.forEach(player => {
                const count = voteCounts[player];
                if (count > 0) {
                    resultsHTML += `<p style="margin-bottom: 0.2rem; font-size: 0.75rem;">${player}: ${count} voto${count !== 1 ? 's' : ''}</p>`;
                }
            });

            // Determinar ganador
            if (tie || maxVotes === 0) {
                resultsHTML += `<div class="winner" style="margin-top: 0.8rem; color: var(--mc-blue); font-size: 1rem;">¬°EMPATE O NADIE VOT√ì!</div>`;
                resultsHTML += `<div class="winner" style="color: var(--mc-red); font-size: 1rem;">¬°EL ESP√çA GANA!</div>`;
                showNotification('¬°Empate! El esp√≠a gana la partida.', 'error', 4000);
            } else {
                const mostVotedIndex = gameData.players.indexOf(mostVotedPlayer);
                resultsHTML += `<div class="winner" style="margin-top: 0.8rem; font-size: 1rem;">${mostVotedPlayer} es expulsado con ${maxVotes} votos.</div>`;

                if (mostVotedIndex === gameData.spyIndex) {
                    resultsHTML += `<div class="winner" style="color: var(--mc-green); font-size: 1rem;">¬°ERA EL ESP√çA! LOS JUGADORES GANAN.</div>`;
                    showNotification('¬°Los jugadores ganan! Descubrieron al esp√≠a.', 'success', 4000);
                } else {
                    resultsHTML += `<div class="winner" style="color: var(--mc-red); font-size: 1rem;">¬°NO ERA EL ESP√çA! EL ESP√çA GANA.</div>`;
                    showNotification('¬°El esp√≠a gana! No fue descubierto.', 'error', 4000);
                }
            }

            results.innerHTML = resultsHTML;

            // Asegurar que los resultados sean desplazables en m√≥viles
            results.scrollTop = 0;

            // Mostrar bot√≥n de nueva partida
            newGameBtn.style.display = 'block';
        }

        // ========== NUEVA PARTIDA ==========
        newGameBtn.addEventListener('click', resetGame);
        newGameBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            resetGame();
        });

        function resetGame() {
            // Feedback t√°ctil
            newGameBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                newGameBtn.style.transform = '';
            }, 150);

            // Resetear datos del juego
            gameData.spyIndex = -1;
            gameData.secretWord = '';
            gameData.currentPlayerIndex = 0;
            gameData.currentVoterIndex = 0;
            gameData.selectedCategory = null;
            gameData.votes = {};
            gameData.votingInProgress = false;
            gameData.timeLeft = 0;
            currentVoteSelection = null;

            // Ocultar elementos flotantes
            floatingTimer.style.display = 'none';
            floatingTimer.classList.remove('warning');
            gameStatus.classList.remove('active');
            floatingVoteBtn.style.display = 'none';
            floatingVoteBtn.style.animation = '';

            // Resetear pantalla de votaci√≥n
            voteOptionsGrid.style.display = 'grid';
            results.classList.remove('active');
            newGameBtn.style.display = 'none';
            submitVoteBtn.style.display = 'none';
            nextVoterBtn.style.display = 'block';

            // Resetear progreso
            playerProgress.style.width = '0%';
            votingProgress.style.width = '0%';

            // Cambiar texto del bot√≥n
            startRoundBtn.textContent = 'SIGUIENTE RONDA';

            // Volver a pantalla de inicio
            showScreen('screen1');
            updateStartButtonState();

            showNotification('¬°Nueva partida lista! Configura las categor√≠as y presiona "SIGUIENTE RONDA".', 'success', 3000);
        }

        // ========== INICIALIZACI√ìN ==========
        window.addEventListener('DOMContentLoaded', () => {
            // Cargar jugadores por defecto
            playersInput.value = gameData.players.join(', ');

            // Inicializar categor√≠as
            initCategories();
            updateStartButtonState();

            // Establecer 3 minutos como seleccionado por defecto
            const defaultTimeOption = document.querySelector('.time-option[data-time="180"]');
            if (defaultTimeOption) {
                defaultTimeOption.classList.add('selected');
            }

            // Prevenir zoom en iOS
            document.addEventListener('gesturestart', (e) => {
                e.preventDefault();
            });

            // Prevenir desplazamiento en iOS cuando no es necesario
            document.addEventListener('touchmove', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                e.preventDefault();
            }, { passive: false });

            // Mostrar mensaje de bienvenida
            setTimeout(() => {
                showNotification('¬°Bienvenido a IMPOSTOR Minecraft Edition!', 'success', 4000);
            }, 1000);

            // Registrar Service Worker para PWA
            registerServiceWorker();
        });

        // Manejar cambios de orientaci√≥n
        window.addEventListener('orientationchange', () => {
            // Forzar reflow para corregir problemas de visualizaci√≥n
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 300);
        });

        // ========== PWA FUNCTIONALITY ==========
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function () {
                    navigator.serviceWorker.register('/sw.js').then(
                        function (registration) {
                            console.log('ServiceWorker registrado con √©xito: ', registration.scope);
                        },
                        function (err) {
                            console.log('Error al registrar ServiceWorker: ', err);
                        }
                    );
                });
            }
        }

        // Solicitar instalaci√≥n como PWA
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevenir que el navegador muestre el prompt autom√°ticamente
            e.preventDefault();
            // Guardar el evento para usarlo despu√©s
            deferredPrompt = e;

            // Mostrar notificaci√≥n para instalar
            setTimeout(() => {
                showNotification('üì≤ Instala esta app para jugar sin conexi√≥n', 'info', 5000);

                // Agregar bot√≥n de instalaci√≥n (opcional)
                const installBtn = document.createElement('button');
                installBtn.className = 'main-btn';
                installBtn.style.position = 'fixed';
                installBtn.style.bottom = '80px';
                installBtn.style.left = '50%';
                installBtn.style.transform = 'translateX(-50%)';
                installBtn.style.zIndex = '1000';
                installBtn.textContent = 'üì≤ INSTALAR APP';
                installBtn.onclick = showInstallPrompt;

                document.body.appendChild(installBtn);

                // Remover despu√©s de 10 segundos
                setTimeout(() => {
                    if (installBtn.parentNode) {
                        installBtn.parentNode.removeChild(installBtn);
                    }
                }, 10000);
            }, 3000);
        });

        function showInstallPrompt() {
            if (deferredPrompt) {
                // Mostrar el prompt de instalaci√≥n
                deferredPrompt.prompt();

                // Esperar a que el usuario responda
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showNotification('¬°App instalada correctamente!', 'success', 3000);
                    } else {
                        showNotification('Instalaci√≥n cancelada', 'info', 3000);
                    }
                    deferredPrompt = null;
                });
            }
        }
    </script>
</body>

</html>